<!DOCTYPE html>
<!--<html xmlns:th="http://www.thymeleaf.org"  lang="en"                        	  xmlns:sec="http://www.w3.org/1999/xhtml"-->


<html xmlns:th="http://www.thymeleaf.org" lang="en" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<head th:replace="partials/head.html :: head ('My Profile')">

</head>
<body>
<header th:replace="partials/navbar.html :: LoggedInNavbar"></header>

<!--This part of the section is was used in the beginning to determine if the user if logged in our not -->
<!--<h1>Profile Page</h1>-->
<!--<div th:if="${loggedInUser.id == user.id}">-->
<!--	<div sec:authorize="isAuthenticated()">-->
<!--		<h3>Welcome, [[${user.username}]]</h3>-->
<!--	</div>-->
<!--</div>-->
<!--&lt;!&ndash;<h1>Hello, <span th:text="${username}">World</span>!</h1>&ndash;&gt;-->
<!--<div th:if="${loggedInUser.id != user.id}">-->
<!--	<h3>[[${user.username}]]</h3>-->
<!--</div>-->

<div class="d-flex w-100 h-100 p-4">
    <!-- Left Bar Section Profile -->
    <section id="profileSidebar" class="profileSidebar w-25 d-none d-md-block pt-5">
        <!-------  Header   ------->
        <div>
            <!-- If the User looks at profile page and its their profile -->
            <!-- Will be introduced to a Welcome username-->
            <div th:if="${loggedInUser.id == user.id}">
                <div sec:authorize="isAuthenticated()">
                    <h1 class="text-center d-block">Welcome, [[${user.username}]]</h1>
                </div>
            </div>
            <!-- If the user looks at another user's profile -->
            <!-- Will see the username of the page owner-->
            <div th:if="${loggedInUser.id != user.id}">
                <h1 class="text-center d-block">[[${user.username}]]</h1>
            </div>
        </div>

        <!-- Personal Information  --->

        <!-- This information will be replaced with a form when the setting button is clicked.  --->
        <div class="p-5" id="profilePageBeforeSettingButtonIsClicked">
            <p><b>Bio: </b><span th:text="${user.bio}"/></p>
            <!--			<p th:text="${user.bio}">Please Create a Bio!</p>-->
            <!--    Personal Email    -->
            <p><b>Email: </b><span th:text="${user.email}"/></p>
            <!--			<p><strong>Personal Email: </strong><span th:text="${user.email}">@Email.com</span></p>-->
            <!-- City State -->
            <p><b>Location: </b><span th:text="${user.city} + ', ' + ${user.state}"/></p>

            <!--Setting gear button-->
            <div th:if="${loggedInUser.id == user.id}">
                <div sec:authorize="isAuthenticated()">
                    <div class="d-flex justify-content-center">
                        <button type="button" class="btn btn-warning w-25" onclick="settingBtnClicked()">
                            <i class="fa-solid fa-gear"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!-- If the user looks at another user's profile -->
            <!-- Will see the username of the page owner-->
            <div th:if="${loggedInUser.id != user.id}">
                <div class="d-none justify-content-center">
                    <button type="button" class="btn btn-warning w-25" onclick="settingBtnClicked()">
                        <i class="fa-solid fa-gear"></i>
                    </button>
                </div>
            </div>
        </div>
        <!--	When the Setting button is clicked  the form will appear	-->
        <form id="profilePageAfterSettingButtonIsClicked"
              th:action="@{/profile/{username}/ (username=${user.getUsername()})}"
              th:object="${user}"
              method="post"
              class="p-5">
            <!--   Settings for   -->
            <!-- First Name-->
            <section class="form-group">
                <label for="firstName" class="text-dark loginLabel"><b>First Name</b></label>
                <input id="firstName"
                       th:field="*{firstName}"
                       th:value="${firstName}"
                       class="form-control"
                       type="text"
                       minlength="3" maxlength="50"
                       title="Uppercase & Lowercase letters only, no punctuation, numbers, or special characters and between 3 and 50 characters"
                       pattern="[a-zA-Z]{3,50}"
                       required>
            </section>
            <!--   Settings for   -->
            <!-- Last Name-->
            <section class="form-group">
                <label for="lastName" class="text-dark loginLabel"><b>Last Name</b></label>
                <input id="lastName"
                       th:field="*{lastName}"
                       th:value="${lastName}"
                       class="form-control"
                       type="text"
                       minlength="3" maxlength="50"
                       title="Uppercase & Lowercase letters only, no punctuation, numbers, or special characters and between 3 and 50 characters"
                       pattern="[a-zA-Z]{3,50}"
                       required>
            </section>
            <!--   Settings for User BIo   -->
            <div class="mb-3">
                <label for="settingUserBio" class="form-label"><b></b>Bio:</b></label>
                <input
                        th:field="*{bio}"
                        th:value="${bio}"
                        type="text"
                        class="form-control"
                        id="settingUserBio"
                        maxlength="250"
                        aria-describedby="settingUserBio">
            </div>
            <!--   Settings for Email Address   -->
            <div class="mb-3">
                <label for="settingEmail" class="form-label"><b>Email address</b></label>
                <input
                        th:field="*{email}"
                        th:value="${email}"
                        minlength="6" maxlength="254"
                        pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                        title="Please provide a valid email"
                        type="email"
                        class="form-control"
                        id="settingEmail"
                        aria-describedby="settingsEmail">
                <p id="emailHelp" class="form-text">We'll never share your email with anyone else.</p>
            </div>
            <!--   Settings for Password   -->
            <div class="mb-3">
                <!--   Second Password     -->
                <label for="settingPassword" class="form-label"><b>Password</b></label>
                <input
                        th:field="*{password}"
                        th:value="${password}"
                        type="password"
                        class="form-control"
                        id="settingPassword"
                        min="6" maxlength="15"
                        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,15}"
                        title="Must contain at least one number and one uppercase and lowercase letter, and at least 6 or more characters"
                        required>
                <p id="passwordConfirmHelp" class="form-text">at least one number and one uppercase and lowercase
                    letter, and at least 6 or more characters</p>
            </div>

            <!-- City-->
            <div class="form-group">
                <label for="city" class="text-dark loginLabel"><b>City</b></label>
                <input id="city"
                       th:field="*{city}"
                       th:value="${city}"
                       class="form-control loginInput"
                       type="text"
                       minlength="3" maxlength="250"
                       title="Provide a city">
            </div>
            <!-- State -->
            <div class="form-group mt-3">
                <label for="state" class="text-dark loginLabel"><b>State</b></label>
                <select id="state" name="state" th:field="*{state}" th:value="${state}">
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District Of Columbia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>
            <div class="d-flex justify-content-center gap-3">
                <button type="button" class="btn btn-light" id="cancelButton" onclick="cancelBtnClicked()">Cancel
                </button>
                <button type="submit" class="btn btn-success">Update</button>

            </div>
        </form>
        <!--            <div class="w-100 d-flex justify-content-center mt-5 pb-5">-->
        <!--                <form method="post" action="/profile/delete">-->
        <!--                    <input type="hidden" th:value="${user.id}" name="deleteProfile">-->
        <!--                    <button class="btn w-75 btn-danger" onclick="return confirm('Are you sure you want to delete this profile?');">Delete Profile</button>-->
        <!--                </form>-->
        <!--            </div>-->

    </section>
    <!-- Right Section Profile -->
    <main class="w-75">
        <section class="text-center my-5 pb-3 container-fluid my-5">
            <h2 class="fw-light pt-3">Your <strong class="fw-bolder">Reviews</strong></h2>
            <main class="row d-flex flex-wrap justify-content-around" >
                <!-- *CARD STARTS -->
                <section class="card border-0 shadow m-2" style="max-width: 483px;" th:each="review : ${reviews}">
                    <!-- lets context and img go side by side with ROW -->
                    <div class="row g-0">
                        <!-- Image Container -->
                        <div class="col-md-4 px-2 py-2 col-10">
                            <!-- Image -->
                            <img th:src="${review.allBookTable.bookImage}" alt="..." class="img-fluid rounded-start"/>
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <!-- Title -->
                                <h5 class="card-title m-0 p-0" th:text="${review.reviewTitle}"></h5>
                                <!-- Username -->
                                <a th:href="|/profile/${review.getUser().getUsername()}|"> <p class="p-0 m-0" th:text="'By '+${review.user.username}"></p></a>
                                <!-- Stars -->
                                <div class="my-2" th:switch="${review.rating}">
                                    <p th:case="'1'">
                                        <i class="fa-solid star fa-star" value="1"></i>
                                        <i class="fa-regular star fa-star" value="2"></i>
                                        <i class="fa-regular star fa-star" value="3"></i>
                                        <i class="fa-regular star fa-star" value="4"></i>
                                        <i class="fa-regular star fa-star" value="5"></i>
                                        <span> 1</span>
                                    </p>
                                    <p th:case="'2'">
                                        <i class="fa-solid star fa-star" value="1"></i>
                                        <i class="fa-solid star fa-star" value="2"></i>
                                        <i class="fa-regular star fa-star" value="3"></i>
                                        <i class="fa-regular star fa-star" value="4"></i>
                                        <i class="fa-regular star fa-star" value="5"></i>
                                        <span> 2</span>
                                    </p>
                                    <p th:case="'3'">
                                        <i class="fa-solid star fa-star" value="1"></i>
                                        <i class="fa-solid star fa-star" value="2"></i>
                                        <i class="fa-solid star fa-star" value="3"></i>
                                        <i class="fa-regular star fa-star" value="4"></i>
                                        <i class="fa-regular star fa-star" value="5"></i>
                                        <span> 3</span>
                                    </p>
                                    <p th:case="'4'">
                                        <i class="fa-solid star fa-star" value="1"></i>
                                        <i class="fa-solid star fa-star" value="2"></i>
                                        <i class="fa-solid star fa-star" value="3"></i>
                                        <i class="fa-solid star fa-star" value="4"></i>
                                        <i class="fa-regular star fa-star" value="5"></i>
                                        <span> 4</span>
                                    </p>
                                    <p th:case="'5'">
                                        <i class="fa-solid star fa-star" value="1"></i>
                                        <i class="fa-solid star fa-star" value="2"></i>
                                        <i class="fa-solid star fa-star" value="3"></i>
                                        <i class="fa-solid star fa-star" value="4"></i>
                                        <i class="fa-solid star fa-star" value="5"></i>
                                        <span> 5</span>
                                    </p>
                                    <!-- To display checked star rating icons -->
                                </div>

                        <!--  Card Body  -->
                        <div class="card-body">
                            <h5 class="card-title h-25" th:text="${review.reviewTitle}"></h5>
                            <p class="card-text cardText" th:text="${review.reviewBody}"></p>
                        </div>

                        <!-- FOOTER -->
                        <div th:if="${loggedInUser.id == user.id}">
                            <div sec:authorize="isAuthenticated()">
                                <div class="d-flex justify-content-center mb-2">
                                    <button type="button" th:value="${review.id}"
                                            class="btn btn-warning w-25 edit-review">
                                        <i class="fa-solid fa-gear unclickable"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- If the user looks at another user's profile -->
                        <!-- Will see the username of the page owner-->
                        <div class="reviewAfterSettingButtonClicked hide text-center" th:data-id="${review.id}">

                            <form
                                    th:action="@{/review/{id}/ (id=${review.id})}"
                                    th:object="${review}"
                                    method="post"
                                    class="p-4 review-update-form"
                            >
                                <section class="form-group p-1">
                                    <label for="reviewTitle" class="text-dark loginLabel"><b>   Title</b></label>
                                    <input id="reviewTitle"

                                            name="reviewTitle"
                                            th:value="${review.reviewTitle}"
                                    >
                                </section>
                                <section class="form-group p-1">
                                    <label for="reviewBody" class="text-dark loginLabel"><b>  Review</b></label>
                                <input id="reviewBody"

                                        name="reviewBody"
                                        th:value="${review.reviewBody}"
                                >
                                </section>
                                <section class="form-group p-1">
                                    <label for="rating" class="text-dark loginLabel"><b>Rating</b></label>
                                <input type="number"
                                        id="rating"
                                       min="1" max="5"
                                        name="rating"
                                        th:value="${review.rating}"
                                >
                                </section>
                                <button class="mt-2" type="submit">Submit</button>
                            </form>
                            <div class="w-100 d-flex justify-content-center mt-5 pb-5">
                                <form class="deleteForm" th:method="post" th:action="@{/review/delete}">
                                    <input type="hidden" th:value="${review.id}" name="deleteReview">
                                    <button class="btn w-90 btn-danger">Delete</button>
                                </form>
                            </div>

                        </div>

                    </div>
                </div>
                <!-- End of Card --->
            </div>
        </section>
    </main>

</div>

<footer th:replace="partials/footer.html :: footer"></footer>
<script th:replace="partials/script.html :: bootstrap-js"></script>

<script>
    function settingBtnClicked() {
        document.getElementById("profilePageAfterSettingButtonIsClicked").style.display = "block";
        document.getElementById("profilePageBeforeSettingButtonIsClicked").style.display = "none";
    }

    function cancelBtnClicked() {
        document.getElementById("profilePageAfterSettingButtonIsClicked").style.display = "none";
        document.getElementById("profilePageBeforeSettingButtonIsClicked").style.display = "block";
    }

    function editReviewBtnClicked(event) {
        const reviewId = event.target.value;


        document.querySelector(`.reviewAfterSettingButtonClicked[data-id="${reviewId}"]`).classList.toggle(`hide`)
    }


    $('.edit-review').click(editReviewBtnClicked);

    // function cancelEditBtnClicked() {
    //     document.getElementById("reviewAfterSettingButtonClicked").style.display = "none";
    //     document.getElementById("reviewAfterSettingButtonClicked").style.display = "block";
    // }
</script>
<script th:replace="partials/script.html :: search-js"></script>

<script>
    $('.deleteForm .btn').click(function (e) {
        e.preventDefault()
        if (confirm("Are you sure you want to delete this review?")) {
            $(".deleteForm").submit();
        }
    })

</script>
</body>
</html>

<!--                    <div class="d-flex justify-content-center">-->
<!--                        <form method= "get" th:action="@{profile/settings/{username}(username=${user.username})}">-->
<!--                            <button type="button" class="btn btn-warning w-25">Profile Settings-->
<!--&lt;!&ndash;                                <i class="fa-solid fa-gear"></i>&ndash;&gt;-->
<!--                            </button>-->
<!--                        </form>-->
<!--                    </div>-->
<!--                </div>-->
<!--    </div>-->
<!--</body>-->
<!--</html>-->